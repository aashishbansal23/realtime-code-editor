{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/new/Desktop/Self_Learning/Real Time Code Editor/realtime-editor/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/new/Desktop/Self_Learning/Real Time Code Editor/realtime-editor/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/new/Desktop/Self_Learning/Real Time Code Editor/realtime-editor/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useRef,useState}from\"react\";import toast from\"react-hot-toast\";import ACTIONS from\"../Actions\";import Client from\"../components/Client\";import Editor from\"../components/Editor\";import{initSocket}from\"../socket\";import{useLocation,useNavigate,Navigate,useParams}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var EditorPage=function EditorPage(){var socketRef=useRef(null);var location=useLocation();var reactNavigator=useNavigate();var codeRef=useRef(null);var _useParams=useParams(),roomId=_useParams.roomId;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),clients=_useState2[0],setClients=_useState2[1];useEffect(function(){var init=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _location$state;var handleErrors;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:handleErrors=function _handleErrors(e){console.log(\"socket error\",e);toast.error(\"Socket connection failed, try again later.\");reactNavigator(\"/\");};_context.next=3;return initSocket();case 3:socketRef.current=_context.sent;socketRef.current.on(\"connect_error\",function(err){return handleErrors(err);});socketRef.current.on(\"connect_failed\",function(err){return handleErrors(err);});socketRef.current.emit(ACTIONS.JOIN,{roomId:roomId,username:(_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.username});socketRef.current.on(ACTIONS.JOINED,function(_ref2){var _location$state2;var clients=_ref2.clients,username=_ref2.username,socketId=_ref2.socketId;if(username!==((_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.username)){toast.success(\"\".concat(username,\" joined the room.\"));console.log(\"\".concat(username,\" joined\"));}setClients(clients);socketRef.current.emit(ACTIONS.SYNC_CODE,{code:codeRef.current,socketId:socketId});});socketRef.current.on(ACTIONS.DISCONNECTED,function(_ref3){var socketId=_ref3.socketId,username=_ref3.username;toast.success(\"\".concat(username,\" left the room.\"));setClients(function(prev){return prev.filter(function(client){return client.socketId!==socketId;});});});case 9:case\"end\":return _context.stop();}}},_callee);}));return function init(){return _ref.apply(this,arguments);};}();init();return function(){socketRef.current.disconnect();socketRef.current.off(ACTIONS.JOINED);socketRef.current.off(ACTIONS.DISCONNECTED);};},[]);function copyRoomId(){return _copyRoomId.apply(this,arguments);}function _copyRoomId(){_copyRoomId=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return navigator.clipboard.writeText(roomId);case 3:toast.success('Room ID has been copied to your clipboard');_context2.next=10;break;case 6:_context2.prev=6;_context2.t0=_context2[\"catch\"](0);toast.error('Could not copy the Room ID');console.log(_context2.t0);case 10:case\"end\":return _context2.stop();}}},_callee2,null,[[0,6]]);}));return _copyRoomId.apply(this,arguments);}function leaveRoom(){reactNavigator('/');}if(!location.state){return/*#__PURE__*/_jsx(Navigate,{to:\"/\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"mainWrap\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"aside\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"asideInner\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"logo\",children:/*#__PURE__*/_jsx(\"img\",{className:\"logoImage\",src:\"/code-sync.png\",alt:\"logo\"})}),/*#__PURE__*/_jsx(\"h3\",{children:\"Connected\"}),/*#__PURE__*/_jsx(\"div\",{className:\"clientsList\",children:clients.map(function(client){return/*#__PURE__*/_jsx(Client,{username:client.username},client.socketId);})})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn copyBtn\",onClick:copyRoomId,children:\"Copy ROOM ID\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn leaveBtn\",onClick:leaveRoom,children:\"Leave\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"editorWrap\",children:/*#__PURE__*/_jsx(Editor,{socketRef:socketRef,roomId:roomId,onCodeChange:function onCodeChange(code){codeRef.current=code;}})})]});};export default EditorPage;","map":{"version":3,"names":["React","useEffect","useRef","useState","toast","ACTIONS","Client","Editor","initSocket","useLocation","useNavigate","Navigate","useParams","EditorPage","socketRef","location","reactNavigator","codeRef","roomId","clients","setClients","init","handleErrors","e","console","log","error","current","on","err","emit","JOIN","username","state","JOINED","socketId","success","SYNC_CODE","code","DISCONNECTED","prev","filter","client","disconnect","off","copyRoomId","navigator","clipboard","writeText","leaveRoom","map"],"sources":["C:/Users/new/Desktop/Self_Learning/Real Time Code Editor/realtime-editor/src/pages/EditorPage.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\nimport toast from \"react-hot-toast\";\r\nimport ACTIONS from \"../Actions\";\r\nimport Client from \"../components/Client\";\r\nimport Editor from \"../components/Editor\";\r\nimport { initSocket } from \"../socket\";\r\nimport {\r\n  useLocation,\r\n  useNavigate,\r\n  Navigate,\r\n  useParams,\r\n} from \"react-router-dom\";\r\n\r\nconst EditorPage = () => {\r\n  const socketRef = useRef(null);\r\n  const location = useLocation();\r\n  const reactNavigator = useNavigate();\r\n  const codeRef = useRef(null);\r\n  const { roomId } = useParams();\r\n\r\n  const [clients, setClients] = useState([]);\r\n\r\n  useEffect(() => {\r\n    const init = async () => {\r\n      socketRef.current = await initSocket();\r\n      socketRef.current.on(\"connect_error\", (err) => handleErrors(err));\r\n      socketRef.current.on(\"connect_failed\", (err) => handleErrors(err));\r\n\r\n      function handleErrors(e) {\r\n        console.log(\"socket error\", e);\r\n        toast.error(\"Socket connection failed, try again later.\");\r\n        reactNavigator(\"/\");\r\n      }\r\n\r\n      socketRef.current.emit(ACTIONS.JOIN, {\r\n        roomId,\r\n        username: location.state?.username,\r\n      });\r\n\r\n      socketRef.current.on(\r\n        ACTIONS.JOINED,\r\n        ({ clients, username, socketId }) => {\r\n          if (username !== location.state?.username) {\r\n            toast.success(`${username} joined the room.`);\r\n            console.log(`${username} joined`);\r\n          }\r\n          setClients(clients);\r\n          socketRef.current.emit(ACTIONS.SYNC_CODE, {\r\n            code: codeRef.current,\r\n            socketId,\r\n          });\r\n        }\r\n      );\r\n\r\n      socketRef.current.on(ACTIONS.DISCONNECTED, ({ socketId, username }) => {\r\n        toast.success(`${username} left the room.`);\r\n        setClients((prev) => {\r\n          return prev.filter((client) => client.socketId !== socketId);\r\n        });\r\n      });\r\n    };\r\n    init();\r\n    return () => {\r\n      socketRef.current.disconnect();\r\n      socketRef.current.off(ACTIONS.JOINED);\r\n      socketRef.current.off(ACTIONS.DISCONNECTED);\r\n    };\r\n  }, []);\r\n\r\n  async function copyRoomId() {\r\n    try {\r\n      await navigator.clipboard.writeText(roomId);\r\n      toast.success('Room ID has been copied to your clipboard')\r\n    } catch (err) {\r\n      toast.error('Could not copy the Room ID');\r\n      console.log(err);\r\n    }\r\n  }\r\n\r\n  function leaveRoom() {\r\n    reactNavigator('/');\r\n  }\r\n\r\n  if (!location.state) {\r\n    return <Navigate to=\"/\" />;\r\n  }\r\n\r\n  return (\r\n    <div className=\"mainWrap\">\r\n      <div className=\"aside\">\r\n        <div className=\"asideInner\">\r\n          <div className=\"logo\">\r\n            <img className=\"logoImage\" src=\"/code-sync.png\" alt=\"logo\" />\r\n          </div>\r\n          <h3>Connected</h3>\r\n          <div className=\"clientsList\">\r\n            {clients.map((client) => (\r\n              <Client key={client.socketId} username={client.username} />\r\n            ))}\r\n          </div>\r\n        </div>\r\n        <button className=\"btn copyBtn\" onClick={copyRoomId}>Copy ROOM ID</button>\r\n        <button className=\"btn leaveBtn\" onClick={leaveRoom}>Leave</button>\r\n      </div>\r\n      <div className=\"editorWrap\">\r\n        <Editor socketRef={socketRef} roomId={roomId} onCodeChange={(code) => {codeRef.current = code}} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EditorPage;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}